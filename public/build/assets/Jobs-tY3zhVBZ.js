import{A as L}from"./aos-DthOhaba.js";import{J as q,a as G}from"./Jobs-Osw3KQKg.js";import{_ as K}from"./AuthenticatedLayout-tqFnkAC4.js";import{m as a,g as W,p as Q,N as X,c as N,o as d,w as Y,a as w,b as e,d as C,j as k,F as Z,q as ee,i as oe,s as g,k as te,t as J,x as re,f as se,n as j,K as ae,z as A}from"./app-YBu4Y6a0.js";import{r as le,C as ne}from"./CreateJob-CGhbaDgq.js";import{d as B}from"./dayjs.min-BtvDDNs6.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as de}from"./BriefcaseIcon-31vLn-gT.js";import{r as ue}from"./CurrencyDollarIcon-BDOYq9u2.js";import{r as ce}from"./CheckCircleIcon-iRs8WVnz.js";import"./index-DKtf60Sy.js";const me={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},be={class:"flex items-center justify-between"},ge={class:"text-sm text-gray-500"},pe={class:"text-xl font-bold"},ve={key:0,class:"mt-2 pt-2 border-t border-primary/10"},fe={class:"text-xs text-gray-500 flex items-center"},ye={class:"px-6 py-4 border-b border-tertiary-light flex justify-between items-center"},he={class:"flex items-center space-x-2"},xe={class:"space-y-6"},we={"data-aos":"fade-up","data-aos-duration":"400","data-aos-delay":"100"},Ce={__name:"Jobs",props:{jobs:Array},setup(_){const n=_,p=a({}),v=a(!1),u=a({}),c=a(!1),m=a(null),F=a(!1),f=a(null);let y=a(!1),T=a(0);const M=({payload:o})=>{f.value=o,y.value=!0},$=()=>{f.value=null,y.value=!1},S=()=>{A.get("/get_customer").then(o=>{m.value=o.data}).catch(o=>{console.error("API error:",o)})},E=()=>{F.value=!0,ae.reload({preserveScroll:!0,onFinish:()=>{F.value=!1}})},V=()=>{S(),c.value=!0},R=()=>{c.value=!1,m.value=null,u.value={},p.value={},v.value=!1},P=({payload:o,amountPaid:t})=>{T.value=t,v.value=!0,u.value=o,p.value=u.value.customer,c.value=!0},I=W(()=>{const o=n.jobs.length,t=n.jobs.filter(s=>s.status==="completed").length,l=n.jobs.reduce((s,i)=>s+Number(i.amount||0),0),r=n.jobs.reduce((s,i)=>s+z(i.activities),0),x=l-r,U=n.jobs.filter(s=>s.due_date&&B().isAfter(B(s.due_date))&&s.status!=="completed").length,b=n.jobs.filter(s=>s.satisfaction_score),H=b.length>0?b.reduce((s,i)=>s+Number(i.satisfaction_score),0)/b.length:0;return[{label:"Total Jobs",value:o,subValue:`${t} completed`,icon:de,color:"var(--primary)",bgColor:"rgba(var(--primary-rgb), 0.1)",dotColor:"#10B981"},{label:"Total Amount",value:h(l),subValue:h(x)+" outstanding",icon:ue,color:"#3B82F6",bgColor:"rgba(59, 130, 246, 0.1)",dotColor:"#F59E0B"},{label:"Total Paid",value:h(r),subValue:`${U} overdue jobs`,icon:ce,color:"#10B981",bgColor:"rgba(16, 185, 129, 0.1)",dotColor:"#EF4444"},{label:"Avg. Rating",value:H.toFixed(1),subValue:`${b.length} ratings`,icon:le,color:"#F59E0B",bgColor:"rgba(245, 158, 11, 0.1)",dotColor:"#3B82F6"}]}),D=o=>{const t=[{border:"primary",bgTo:"primary/20"},{border:"blue-500",bgTo:"blue-500/20"},{border:"green-500",bgTo:"green-500/20"},{border:"yellow-500",bgTo:"yellow-500/20"}];return{borderColor:`var(--${t[o].border})`,background:`linear-gradient(to bottom right, white, var(--${t[o].bgTo}))`}},z=o=>o?o.filter(t=>t.type==="payment").reduce((t,l)=>{const r=JSON.parse(l.changes);return t+Number(r.amount)},0):0,h=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"NGN"}).format(o);let O=({payload:o,jobId:t})=>{A.patch(`/job_update/status/${t}`,{type:"complete_job",satisfaction_score:o}).then(l=>{$(),alert(l.data.message)})};return Q(()=>{L.init({once:!0,easing:"ease-out-cubic",offset:50})}),(o,t)=>{const l=X("motion-pop");return d(),N(K,null,{default:Y(()=>[w(ne,{showModal:c.value,customer:p.value,isEditingJob:v.value,jobToEdit:u.value,amountPaid:C(T),allCustomers:m.value,onClose:R,onSubmit:E},null,8,["showModal","customer","isEditingJob","jobToEdit","amountPaid","allCustomers"]),w(q,{jobId:f.value,showModal:C(y),onSubmit:C(O),onClose:$},null,8,["jobId","showModal","onSubmit"]),e("header",{class:"mb-8"},[e("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},[t[5]||(t[5]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"hidden md:block w-1.5 h-8 rounded-full bg-primary"}),e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"All Jobs"),e("p",{class:"text-gray-500 dark:text-gray-400 mt-1"}," Overview of all your active and completed jobs ")])],-1)),e("div",{class:"flex gap-3"},[e("button",{onClick:V,class:"flex items-center gap-2 px-4 py-2.5 bg-primary hover:bg-primary-dark text-white rounded-lg transition-all shadow-sm hover:shadow-md"},t[3]||(t[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),e("span",null,"New Job",-1)])),e("button",{onClick:E,class:"flex items-center gap-2 px-4 py-2.5 border border-gray-300 hover:border-primary/30 bg-white hover:bg-primary/5 text-gray-700 rounded-lg transition-all shadow-sm hover:shadow-md"},t[4]||(t[4]=[e("span",null,"Refresh",-1)]))])])]),e("div",me,[(d(!0),k(Z,null,ee(I.value,(r,x)=>oe((d(),k("div",{key:r.label,class:"bg-gradient-to-br from-white to-primary/20 border border-primary/30 p-4 rounded-xl shadow-sm transition-all hover:shadow-md",style:g(D(x))},[e("div",be,[e("div",null,[e("p",ge,J(r.label),1),e("h3",pe,J(r.value),1)]),e("div",{class:"p-3 rounded-lg",style:g({background:r.bgColor})},[(d(),N(re(r.icon),{class:"h-6 w-6",style:g({color:r.color})},null,8,["style"]))],4)]),r.subValue?(d(),k("div",ve,[e("p",fe,[e("span",{class:"w-2 h-2 rounded-full mr-1",style:g({background:r.dotColor})},null,4),se(" "+J(r.subValue),1)])])):te("",!0)],4)),[[l]])),128))]),e("div",ye,[t[6]||(t[6]=e("h2",{class:"text-xl font-bold text-primary-dark"},"Job History",-1)),e("div",he,[e("button",{onClick:t[0]||(t[0]=r=>o.filterJobs("all")),class:j(["px-3 py-1 text-sm rounded-md",{"bg-primary-DEFAULT text-white":o.activeFilter==="all","text-primary-dark hover:bg-tertiary-light":o.activeFilter!=="all"}])}," All ",2),e("button",{onClick:t[1]||(t[1]=r=>o.filterJobs("active")),class:j(["px-3 py-1 text-sm rounded-md",{"bg-secondary-light text-secondary-dark":o.activeFilter==="active","text-primary-dark hover:bg-tertiary-light":o.activeFilter!=="active"}])}," Active ",2),e("button",{onClick:t[2]||(t[2]=r=>o.filterJobs("completed")),class:j(["px-3 py-1 text-sm rounded-md",{"bg-green-100 text-green-800":o.activeFilter==="completed","text-primary-dark hover:bg-tertiary-light":o.activeFilter!=="completed"}])}," Completed ",2)])]),e("div",xe,[e("div",we,[w(G,{jobs:_.jobs,allCustomers:m.value,onIsEditing:P,onJobCompleted:M,class:""},null,8,["jobs","allCustomers"])])])]),_:1})}}},Me=ie(Ce,[["__scopeId","data-v-661e92ba"]]);export{Me as default};
