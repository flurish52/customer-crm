import{A as G}from"./aos-D0qa94jJ.js";import{m as d,j as H,N as T,g as l,o as r,b as e,F as N,q as L,k as _,s as B,i as F,t as n,c as V,x as K,f as Q,w as D,n as I,e as z,O as X,a as S,T as Z,z as ee,p as te,C as oe}from"./app-QB0zDPA2.js";import{g as se}from"./index-CH_iu5NA.js";import{d as k}from"./dayjs.min-Co4sUPww.js";import{r as re,V as le}from"./ViewJob-3YtoPKJL.js";import{C as ae}from"./CreateJob-ByIIeYIx.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as ne}from"./BriefcaseIcon-Dj8roTrD.js";import{r as ie}from"./CurrencyDollarIcon-DhlwNTsT.js";import{r as de}from"./CheckCircleIcon-daPDYa78.js";import{_ as ce}from"./AuthenticatedLayout-Cf9bjmOJ.js";const ue={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},me={class:"flex items-center justify-between"},pe={class:"text-sm text-gray-500"},ge={class:"text-2xl font-bold"},ve={key:0,class:"mt-2 pt-2 border-t border-primary/10"},be={class:"text-xs text-gray-500 flex items-center"},he={class:"space-y-4"},ye=["data-index"],we={class:"flex justify-between items-start mb-3"},xe={class:"max-w-[80%]"},fe={class:"font-semibold text-lg truncate text-primary-dark"},_e={class:"flex items-center mt-1"},ke={class:"text-sm opacity-80 truncate text-secondary-gray-400"},Ce={key:0,class:"ml-2 text-xs px-2 py-0.5 bg-red-100 text-red-700 rounded-full"},Me={class:"mt-4 pt-4",style:{borderTop:"1px solid rgba(var(--primary-rgb), 0.1)"}},Je={class:"grid grid-cols-2 gap-4 mb-4"},Be={class:"space-y-2"},Ve={class:"flex items-center"},Ee={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},$e={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},je={class:"text-sm font-medium"},Ae={key:0,class:"flex items-center"},Te={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},Ne={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},Fe={class:"text-sm font-medium"},ze={class:"space-y-2"},De={class:"flex items-center"},Se={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},Pe={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},He={class:"text-sm font-medium text-green-600"},Le={class:"flex items-center"},Ie={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},Oe={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},Ye={class:"flex items-center justify-between"},Re={key:0,class:"flex items-center rounded-full px-3 py-1.5 backdrop-blur-sm",style:{background:"rgba(var(--primary-rgb), 0.15)"}},Ue={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},qe={class:"text-xs font-medium"},We={key:1},Ge={class:"flex justify-end space-x-2"},Ke=["onClick"],Qe={xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},Xe=["onClick"],Ze=["onClick"],et={class:"border rounded-lg p-5",style:{backgroundColor:"var(--secondary)",borderColor:"var(--tertiary)"}},tt={__name:"Jobs",props:{jobs:{type:Array,required:!0},showModal:Boolean,allCustomers:Array},emits:["closeModal","showModal","isEditing","update"],setup(C,{emit:w}){const i=C,u=w,c=d(null),h=d({});d(!1),d({});const x=o=>{const t=P.value[o.id];return Number(o.amount||0)-Number(t)},E=o=>x(o)<=0?"text-green-600":k().isAfter(k(o.due_date))&&o.status!=="completed"?"text-yellow-600":"text-red-600",M=o=>o?o.filter(t=>t.type==="payment").reduce((t,y)=>{const v=JSON.parse(y.changes);return t+Number(v.amount)},0):0,m=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o),$=o=>o?k(o).format("MMM D, YYYY"):"Not set",j=o=>{u("showModal"),h.value=o.customer,u("isEditing",{payload:o})},p=o=>{c.value=o},g=()=>{c.value=null},Y=o=>{confirm(`Are you sure you want to delete "${o.job_title}"?`)&&ee.delete(`/job_delete/${o.id}`).then(t=>{t.status===200&&(u("update"),alert(t.data))}).catch(t=>{console.error("Error deleting job:",t),alert("Failed to delete job. Please try again.")})},R=o=>{o.style.opacity=0,o.style.transform="translateY(20px)"},U=(o,t)=>{se.to(o,{opacity:1,y:0,duration:.5,delay:o.dataset.index*.1,onComplete:t})},q=H(()=>{const o=i.jobs.length,t=i.jobs.filter(a=>a.status==="completed").length,y=i.jobs.reduce((a,f)=>a+Number(f.amount||0),0),v=i.jobs.reduce((a,f)=>a+M(f.activities),0),A=y-v,s=i.jobs.filter(a=>a.due_date&&k().isAfter(k(a.due_date))&&a.status!=="completed").length,b=i.jobs.filter(a=>a.satisfaction_score),J=b.length>0?b.reduce((a,f)=>a+Number(f.satisfaction_score),0)/b.length:0;return[{label:"Total Jobs",value:o,subValue:`${t} completed`,icon:ne,color:"var(--primary)",bgColor:"rgba(var(--primary-rgb), 0.1)",dotColor:"#10B981"},{label:"Total Amount",value:m(y),subValue:m(A)+" outstanding",icon:ie,color:"#3B82F6",bgColor:"rgba(59, 130, 246, 0.1)",dotColor:"#F59E0B"},{label:"Total Paid",value:m(v),subValue:`${s} overdue jobs`,icon:de,color:"#10B981",bgColor:"rgba(16, 185, 129, 0.1)",dotColor:"#EF4444"},{label:"Avg. Rating",value:J.toFixed(1),subValue:`${b.length} ratings`,icon:re,color:"#F59E0B",bgColor:"rgba(245, 158, 11, 0.1)",dotColor:"#3B82F6"}]}),W=o=>{const t=[{border:"primary",bgTo:"primary/20"},{border:"blue-500",bgTo:"blue-500/20"},{border:"green-500",bgTo:"green-500/20"},{border:"yellow-500",bgTo:"yellow-500/20"}];return{borderColor:`var(--${t[o].border})`,background:`linear-gradient(to bottom right, white, var(--${t[o].bgTo}))`}},P=H(()=>i.jobs.reduce((o,t)=>(o[t.id]=M(t.activities),o),{}));return(o,t)=>{const y=T("motion-pop"),v=T("tooltip"),A=T("motion-slide-visible-once-bottom");return r(),l(N,null,[e("div",ue,[(r(!0),l(N,null,L(q.value,(s,b)=>_((r(),l("div",{key:s.label,class:"bg-gradient-to-br from-white to-primary/20 border border-primary/30 p-4 rounded-xl shadow-sm transition-all hover:shadow-md",style:B(W(b))},[e("div",me,[e("div",null,[e("p",pe,n(s.label),1),e("h3",ge,n(s.value),1)]),e("div",{class:"p-3 rounded-lg",style:B({background:s.bgColor})},[(r(),V(K(s.icon),{class:"h-6 w-6",style:B({color:s.color})},null,8,["style"]))],4)]),s.subValue?(r(),l("div",ve,[e("p",be,[e("span",{class:"w-2 h-2 rounded-full mr-1",style:B({background:s.dotColor})},null,4),Q(" "+n(s.subValue),1)])])):F("",!0)],4)),[[y]])),128))]),e("div",he,[c.value?(r(),V(Z,{key:1,name:"fade-slide",mode:"out-in"},{default:D(()=>[e("div",et,[S(le,{onCloseModal:g,selectedJob:c.value},null,8,["selectedJob"])])]),_:1})):(r(),V(X,{key:0,name:"staggered-fade",tag:"div",class:"space-y-3",appear:"",onBeforeEnter:R,onEnter:U},{default:D(()=>[(r(!0),l(N,null,L(C.jobs,(s,b)=>_((r(),l("div",{key:s.id,"data-index":b,class:"bg-gradient-to-br from-white to-primary/20 border border-primary shadow-md p-4 rounded-xl cursor-pointer transition-all duration-300 hover:shadow-xl hover:-translate-y-1.5"},[e("div",we,[e("div",xe,[e("h3",fe,n(s.job_title),1),e("div",_e,[e("p",ke,n(s.customer.company)+" â€¢ "+n(s.customer.name),1),s.customer.is_owing?(r(),l("span",Ce," Owing ")):F("",!0)])]),e("span",{class:I([{"bg-gray-100 text-gray-700":!s.status,"bg-green-100 text-green-700":s.status==="completed","bg-blue-100 text-blue-700":s.status==="in_progress","bg-yellow-100 text-yellow-700":s.status==="pending","bg-red-100 text-red-700":s.status==="overdue"},"text-xs font-medium px-3 py-1 rounded-full capitalize shadow-sm transform transition-all hover:scale-105"])},n(s.status||"not started"),3)]),e("div",Me,[e("div",Je,[e("div",Be,[e("div",Ve,[e("div",Ee,[(r(),l("svg",$e,t[0]||(t[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])))]),e("div",null,[t[1]||(t[1]=e("p",{class:"text-xs text-gray-500"},"Amount",-1)),e("p",je,n(m(s.amount)),1)])]),s.due_date?(r(),l("div",Ae,[e("div",Te,[(r(),l("svg",Ne,t[2]||(t[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)])))]),e("div",null,[t[3]||(t[3]=e("p",{class:"text-xs text-gray-500"},"Due Date",-1)),e("p",Fe,n($(s.due_date)),1)])])):F("",!0)]),e("div",ze,[e("div",De,[e("div",Se,[(r(),l("svg",Pe,t[4]||(t[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])))]),e("div",null,[t[5]||(t[5]=e("p",{class:"text-xs text-gray-500"},"Paid",-1)),e("p",He,n(m(P.value[s.id])),1)])]),e("div",Le,[e("div",Ie,[(r(),l("svg",Oe,t[6]||(t[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])))]),e("div",null,[t[7]||(t[7]=e("p",{class:"text-xs text-gray-500"},"Balance",-1)),e("p",{class:I(["text-sm font-medium",E(s)])},n(m(x(s))),3)])])])]),e("div",Ye,[s.satisfaction_score?(r(),l("div",Re,[(r(),l("svg",Ue,t[8]||(t[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"},null,-1)]))),e("span",qe,n(s.satisfaction_score)+"/5",1)])):(r(),l("div",We)),e("div",Ge,[_((r(),l("button",{onClick:z(J=>p(s),["stop"]),class:"group flex items-center justify-center p-2 rounded-lg transition-all duration-200 hover:bg-white hover:shadow-md",style:{border:"1px solid rgba(var(--primary-rgb), 0.3)"}},[(r(),l("svg",Qe,t[9]||(t[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])))],8,Ke)),[[v,"View details"]]),_((r(),l("button",{onClick:z(J=>j(s),["stop"]),class:"group flex items-center justify-center p-2 rounded-lg transition-all duration-200 hover:bg-white hover:shadow-md",style:{border:"1px solid rgba(59, 130, 246, 0.3)"}},t[10]||(t[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,Xe)),[[v,"Edit job"]]),_((r(),l("button",{onClick:z(J=>Y(s),["stop"]),class:"group flex items-center justify-center p-2 rounded-lg transition-all duration-200 hover:bg-white hover:shadow-md",style:{border:"1px solid rgba(239, 68, 68, 0.3)"}},t[11]||(t[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Ze)),[[v,"Delete job"]])])])])],8,ye)),[[A]])),128))]),_:1}))])],64)}}},ot=O(tt,[["__scopeId","data-v-4646985f"]]),st={class:"space-y-6"},rt={"data-aos":"fade-up","data-aos-duration":"400","data-aos-delay":"100"},lt={__name:"Jobs",props:{jobs:Array},setup(C){const w=d({}),i=d(!1),u=d({}),c=d(!1),h=d(null),x=d(!1),E=()=>{axios.get("/get_customer").then(p=>{h.value=p.data}).catch(p=>{console.error("API error:",p)})},M=()=>{x.value=!0,oe.reload({preserveScroll:!0,onFinish:()=>{x.value=!1}})},m=()=>{E(),c.value=!0},$=()=>{c.value=!1,h.value=null,u.value={},w.value={},i.value=!1},j=({payload:p})=>{i.value=!0,u.value=p,w.value=u.value.customer,c.value=!0};return te(()=>{G.init({once:!0,easing:"ease-out-cubic",offset:50})}),(p,g)=>(r(),V(ce,null,{default:D(()=>[S(ae,{showModal:c.value,customer:w.value,isEditingJob:i.value,jobToEdit:u.value,allCustomers:h.value,onClose:$,onSubmit:M},null,8,["showModal","customer","isEditingJob","jobToEdit","allCustomers"]),e("header",{class:"mb-8"},[e("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},[g[2]||(g[2]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"hidden md:block w-1.5 h-8 rounded-full bg-primary"}),e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"All Jobs"),e("p",{class:"text-gray-500 dark:text-gray-400 mt-1"}," Overview of all your active and completed jobs ")])],-1)),e("div",{class:"flex gap-3"},[e("button",{onClick:m,class:"flex items-center gap-2 px-4 py-2.5 bg-primary hover:bg-primary-dark text-white rounded-lg transition-all shadow-sm hover:shadow-md"},g[0]||(g[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),e("span",null,"New Job",-1)])),g[1]||(g[1]=e("button",{class:"flex items-center gap-2 px-4 py-2.5 border border-gray-300 hover:border-primary/30 bg-white hover:bg-primary/5 text-gray-700 rounded-lg transition-all shadow-sm hover:shadow-md"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})]),e("span",null,"Filters")],-1))])])]),e("div",st,[e("div",rt,[S(ot,{jobs:C.jobs,allCustomers:h.value,onIsEditing:j,class:"mt-6"},null,8,["jobs","allCustomers"])])])]),_:1}))}},ht=O(lt,[["__scopeId","data-v-e6be4c43"]]);export{ht as default};
