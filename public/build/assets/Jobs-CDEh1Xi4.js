import{A as L}from"./aos-Dbb6uvOV.js";import{J as q,a as G}from"./Jobs-C4mJdFBg.js";import{_ as Q}from"./AuthenticatedLayout-DgHnd84g.js";import{m as a,g as W,p as K,Q as X,c as A,o as d,w as Y,a as g,b as e,d as p,h as Z,j as k,F as ee,q as oe,i as te,s as v,k as re,t as J,x as se,f as ae,n as j,E as le,z as B}from"./app-CAzgmfma.js";import{C as ne}from"./CreateJob-BRpPkP0m.js";import{d as N}from"./dayjs.min-WXjqb0z8.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as de}from"./BriefcaseIcon-BxKQGKsl.js";import{r as ue}from"./CurrencyDollarIcon-Bc9gIuGZ.js";import{r as ce}from"./CheckCircleIcon-Sn3100fl.js";import{a as me}from"./CreateInvoiceModal-DQb8XdU7.js";import"./index-DKtf60Sy.js";const be={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},ge={class:"flex items-center justify-between"},pe={class:"text-sm text-gray-500"},ve={class:"text-xl font-bold"},fe={key:0,class:"mt-2 pt-2 border-t border-primary/10"},he={class:"text-xs text-gray-500 flex items-center"},ye={class:"px-6 py-4 border-b border-tertiary-light flex justify-between items-center"},xe={class:"flex items-center space-x-2"},we={class:"space-y-6"},Ce={"data-aos":"fade-up","data-aos-duration":"400","data-aos-delay":"100"},ke={__name:"Jobs",props:{jobs:Array},setup(_){const n=_,f=a({}),h=a(!1),u=a({}),c=a(!1),m=a(null),F=a(!1),y=a(null);let x=a(!1),E=a(0);const S=({payload:o})=>{y.value=o,x.value=!0},T=()=>{y.value=null,x.value=!1},V=()=>{B.get("/get_customer").then(o=>{m.value=o.data}).catch(o=>{console.error("API error:",o)})},$=()=>{F.value=!0,le.reload({preserveScroll:!0,onFinish:()=>{F.value=!1}})},M=()=>{V(),c.value=!0},R=()=>{c.value=!1,m.value=null,u.value={},f.value={},h.value=!1},P=({payload:o,amountPaid:t})=>{E.value=t,h.value=!0,u.value=o,f.value=u.value.customer,c.value=!0},I=W(()=>{const o=n.jobs.length,t=n.jobs.filter(s=>s.status==="completed").length,l=n.jobs.reduce((s,i)=>s+Number(i.amount||0),0),r=n.jobs.reduce((s,i)=>s+z(i.activities),0),C=l-r,U=n.jobs.filter(s=>s.due_date&&N().isAfter(N(s.due_date))&&s.status!=="completed").length,b=n.jobs.filter(s=>s.satisfaction_score),H=b.length>0?b.reduce((s,i)=>s+Number(i.satisfaction_score),0)/b.length:0;return[{label:"Total Jobs",value:o,subValue:`${t} completed`,icon:de,color:"var(--primary)",bgColor:"rgba(var(--primary-rgb), 0.1)",dotColor:"#10B981"},{label:"Total Amount",value:w(l),subValue:w(C)+" outstanding",icon:ue,color:"#3B82F6",bgColor:"rgba(59, 130, 246, 0.1)",dotColor:"#F59E0B"},{label:"Total Paid",value:w(r),subValue:`${U} overdue jobs`,icon:ce,color:"#10B981",bgColor:"rgba(16, 185, 129, 0.1)",dotColor:"#EF4444"},{label:"Avg. Rating",value:H.toFixed(1),subValue:`${b.length} ratings`,icon:me,color:"#F59E0B",bgColor:"rgba(245, 158, 11, 0.1)",dotColor:"#3B82F6"}]}),D=o=>{const t=[{border:"primary",bgTo:"primary/20"},{border:"blue-500",bgTo:"blue-500/20"},{border:"green-500",bgTo:"green-500/20"},{border:"yellow-500",bgTo:"yellow-500/20"}];return{borderColor:`var(--${t[o].border})`,background:`linear-gradient(to bottom right, white, var(--${t[o].bgTo}))`}},z=o=>o?o.filter(t=>t.type==="payment").reduce((t,l)=>{const r=JSON.parse(l.changes);return t+Number(r.amount)},0):0,w=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"NGN"}).format(o);let O=({payload:o,jobId:t})=>{B.patch(`/job_update/status/${t}`,{type:"complete_job",satisfaction_score:o}).then(l=>{T(),alert(l.data.message)})};return K(()=>{L.init({once:!0,easing:"ease-out-cubic",offset:50})}),(o,t)=>{const l=X("motion-pop");return d(),A(Q,null,{default:Y(()=>[g(ne,{showModal:c.value,customer:f.value,isEditingJob:h.value,jobToEdit:u.value,amountPaid:p(E),allCustomers:m.value,onClose:R,onSubmit:$},null,8,["showModal","customer","isEditingJob","jobToEdit","amountPaid","allCustomers"]),g(q,{jobId:y.value,showModal:p(x),onSubmit:p(O),onClose:T},null,8,["jobId","showModal","onSubmit"]),g(p(Z),{title:"Jobs"}),e("header",{class:"mb-8"},[e("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},[t[5]||(t[5]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"hidden md:block w-1.5 h-8 rounded-full bg-primary"}),e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"All Jobs"),e("p",{class:"text-gray-500 dark:text-gray-400 mt-1"}," Overview of all your active and completed jobs ")])],-1)),e("div",{class:"flex gap-3"},[e("button",{onClick:M,class:"flex items-center gap-2 px-4 py-2.5 bg-primary hover:bg-primary-dark text-white rounded-lg transition-all shadow-sm hover:shadow-md"},t[3]||(t[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),e("span",null,"New Job",-1)])),e("button",{onClick:$,class:"flex items-center gap-2 px-4 py-2.5 border border-gray-300 hover:border-primary/30 bg-white hover:bg-primary/5 text-gray-700 rounded-lg transition-all shadow-sm hover:shadow-md"},t[4]||(t[4]=[e("span",null,"Refresh",-1)]))])])]),e("div",be,[(d(!0),k(ee,null,oe(I.value,(r,C)=>te((d(),k("div",{key:r.label,class:"bg-gradient-to-br from-white to-primary/20 border border-primary/30 p-4 rounded-xl shadow-sm transition-all hover:shadow-md",style:v(D(C))},[e("div",ge,[e("div",null,[e("p",pe,J(r.label),1),e("h3",ve,J(r.value),1)]),e("div",{class:"p-3 rounded-lg",style:v({background:r.bgColor})},[(d(),A(se(r.icon),{class:"h-6 w-6",style:v({color:r.color})},null,8,["style"]))],4)]),r.subValue?(d(),k("div",fe,[e("p",he,[e("span",{class:"w-2 h-2 rounded-full mr-1",style:v({background:r.dotColor})},null,4),ae(" "+J(r.subValue),1)])])):re("",!0)],4)),[[l]])),128))]),e("div",ye,[t[6]||(t[6]=e("h2",{class:"text-xl font-bold text-primary-dark"},"Job History",-1)),e("div",xe,[e("button",{onClick:t[0]||(t[0]=r=>o.filterJobs("all")),class:j(["px-3 py-1 text-sm rounded-md",{"bg-primary-DEFAULT text-white":o.activeFilter==="all","text-primary-dark hover:bg-tertiary-light":o.activeFilter!=="all"}])}," All ",2),e("button",{onClick:t[1]||(t[1]=r=>o.filterJobs("active")),class:j(["px-3 py-1 text-sm rounded-md",{"bg-secondary-light text-secondary-dark":o.activeFilter==="active","text-primary-dark hover:bg-tertiary-light":o.activeFilter!=="active"}])}," Active ",2),e("button",{onClick:t[2]||(t[2]=r=>o.filterJobs("completed")),class:j(["px-3 py-1 text-sm rounded-md",{"bg-green-100 text-green-800":o.activeFilter==="completed","text-primary-dark hover:bg-tertiary-light":o.activeFilter!=="completed"}])}," Completed ",2)])]),e("div",we,[e("div",Ce,[g(G,{jobs:_.jobs,onShowModal:M,allCustomers:m.value,onIsEditing:P,onJobCompleted:S,class:""},null,8,["jobs","allCustomers"])])])]),_:1})}}},Ve=ie(ke,[["__scopeId","data-v-ea40dfda"]]);export{Ve as default};
