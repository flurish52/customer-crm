import{A as Q}from"./aos-CKG482gy.js";import{m as d,g as O,N as Y,j as l,o as r,b as e,F as R,q as U,i as q,s as $,k as E,t as i,c as V,x as X,f as Z,w as I,n as W,e as P,O as ee,a as T,T as te,z as H,p as oe,d as se,M as re}from"./app-DXhGyOzx.js";import{g as le}from"./index-DKtf60Sy.js";import{d as J}from"./dayjs.min-Bsuiihyv.js";import{r as ae,V as ne}from"./ViewJob-URTvAjRZ.js";import{C as ie}from"./CreateJob-BDFG8ZLc.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as de}from"./BriefcaseIcon-BxSQOVGC.js";import{r as ce}from"./CurrencyDollarIcon-_MFVmX68.js";import{r as ue}from"./CheckCircleIcon-CyPdzm8S.js";import{_ as me}from"./AuthenticatedLayout-DUotfyN9.js";import{J as pe}from"./JobRating-BGT8QAQ4.js";const ge={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},ve={class:"flex items-center justify-between"},be={class:"text-sm text-gray-500"},he={class:"text-2xl font-bold"},ye={key:0,class:"mt-2 pt-2 border-t border-primary/10"},we={class:"text-xs text-gray-500 flex items-center"},fe={class:"space-y-4"},xe=["data-index"],_e={class:"flex justify-between items-start mb-3"},ke={class:"max-w-[80%]"},Ce={class:"font-semibold text-lg truncate text-primary-dark"},Me={class:"flex items-center mt-1"},Je={class:"text-sm opacity-80 truncate text-secondary-gray-400"},je={key:0,class:"ml-2 text-xs px-2 py-0.5 bg-red-100 text-red-700 rounded-full"},Be={class:"mt-4 pt-4",style:{borderTop:"1px solid rgba(var(--primary-rgb), 0.1)"}},$e={class:"grid grid-cols-2 gap-4 mb-4"},Ee={class:"space-y-2"},Ve={class:"flex items-center"},Te={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},Ae={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},Ne={class:"text-sm font-medium"},Fe={key:0,class:"flex items-center"},Se={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},ze={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},De={class:"text-sm font-medium"},Re={class:"space-y-2"},Pe={class:"flex items-center"},Ie={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},He={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},Le={class:"text-sm font-medium text-green-600"},Oe={class:"flex items-center"},Ye={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},Ue={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},qe={class:"flex items-center justify-between"},We={key:0,class:"flex items-center rounded-full px-3 py-1.5 backdrop-blur-sm",style:{background:"rgba(var(--primary-rgb), 0.15)"}},Ge={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},Ke={class:"text-xs font-medium"},Qe={key:1},Xe={class:"flex justify-end space-x-2 bg-tertiary-dark/20 p-1 rounded-md"},Ze=["onClick"],et={xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},tt=["onClick"],ot=["onClick"],st=["onClick"],rt={key:1,class:"flex flex-col items-center justify-center p-6 bg-gray-50 rounded-lg shadow-md text-center"},lt={class:"border rounded-lg p-5",style:{backgroundColor:"var(--secondary)",borderColor:"var(--tertiary)"}},at={__name:"Jobs",props:{jobs:{type:Array,required:!0},showModal:Boolean,allCustomers:Array},emits:["closeModal","showModal","isEditing","update","jobCompleted"],setup(f,{emit:x}){const c=f,m=x,p=d(null),b=d({});d(!1),d({});const j=o=>{m("jobCompleted",{payload:o})},h=o=>{const t=L.value[o.id];return Number(o.amount||0)-Number(t)},_=o=>h(o)<=0?"text-green-600":J().isAfter(J(o.due_date))&&o.status!=="completed"?"text-yellow-600":"text-red-600",B=o=>o?o.filter(t=>t.type==="payment").reduce((t,y)=>{const w=JSON.parse(y.changes);return t+Number(w.amount)},0):0,g=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o),A=o=>o?J(o).format("MMM D, YYYY"):"Not set",k=o=>{m("showModal"),b.value=o.customer,m("isEditing",{payload:o})},N=o=>{p.value=o},F=()=>{p.value=null},S=o=>{confirm(`Are you sure you want to delete "${o.job_title}"?`)&&H.delete(`/job_delete/${o.id}`).then(t=>{t.status===200&&(m("update"),alert(t.data))}).catch(t=>{console.error("Error deleting job:",t),alert("Failed to delete job. Please try again.")})},z=o=>{o.style.opacity=0,o.style.transform="translateY(20px)"},n=(o,t)=>{le.to(o,{opacity:1,y:0,duration:.5,delay:o.dataset.index*.1,onComplete:t})},u=O(()=>{const o=c.jobs.length,t=c.jobs.filter(a=>a.status==="completed").length,y=c.jobs.reduce((a,M)=>a+Number(M.amount||0),0),w=c.jobs.reduce((a,M)=>a+B(M.activities),0),s=y-w,C=c.jobs.filter(a=>a.due_date&&J().isAfter(J(a.due_date))&&a.status!=="completed").length,v=c.jobs.filter(a=>a.satisfaction_score),K=v.length>0?v.reduce((a,M)=>a+Number(M.satisfaction_score),0)/v.length:0;return[{label:"Total Jobs",value:o,subValue:`${t} completed`,icon:de,color:"var(--primary)",bgColor:"rgba(var(--primary-rgb), 0.1)",dotColor:"#10B981"},{label:"Total Amount",value:g(y),subValue:g(s)+" outstanding",icon:ce,color:"#3B82F6",bgColor:"rgba(59, 130, 246, 0.1)",dotColor:"#F59E0B"},{label:"Total Paid",value:g(w),subValue:`${C} overdue jobs`,icon:ue,color:"#10B981",bgColor:"rgba(16, 185, 129, 0.1)",dotColor:"#EF4444"},{label:"Avg. Rating",value:K.toFixed(1),subValue:`${v.length} ratings`,icon:ae,color:"#F59E0B",bgColor:"rgba(245, 158, 11, 0.1)",dotColor:"#3B82F6"}]}),D=o=>{const t=[{border:"primary",bgTo:"primary/20"},{border:"blue-500",bgTo:"blue-500/20"},{border:"green-500",bgTo:"green-500/20"},{border:"yellow-500",bgTo:"yellow-500/20"}];return{borderColor:`var(--${t[o].border})`,background:`linear-gradient(to bottom right, white, var(--${t[o].bgTo}))`}},L=O(()=>c.jobs.reduce((o,t)=>(o[t.id]=B(t.activities),o),{}));return(o,t)=>{const y=Y("motion-pop"),w=Y("motion-slide-visible-once-bottom");return r(),l(R,null,[e("div",ge,[(r(!0),l(R,null,U(u.value,(s,C)=>q((r(),l("div",{key:s.label,class:"bg-gradient-to-br from-white to-primary/20 border border-primary/30 p-4 rounded-xl shadow-sm transition-all hover:shadow-md",style:$(D(C))},[e("div",ve,[e("div",null,[e("p",be,i(s.label),1),e("h3",he,i(s.value),1)]),e("div",{class:"p-3 rounded-lg",style:$({background:s.bgColor})},[(r(),V(X(s.icon),{class:"h-6 w-6",style:$({color:s.color})},null,8,["style"]))],4)]),s.subValue?(r(),l("div",ye,[e("p",we,[e("span",{class:"w-2 h-2 rounded-full mr-1",style:$({background:s.dotColor})},null,4),Z(" "+i(s.subValue),1)])])):E("",!0)],4)),[[y]])),128))]),e("div",fe,[p.value?(r(),V(te,{key:1,name:"fade-slide",mode:"out-in"},{default:I(()=>[e("div",lt,[T(ne,{onCloseModal:F,selectedJob:p.value},null,8,["selectedJob"])])]),_:1})):(r(),V(ee,{key:0,name:"staggered-fade",tag:"div",class:"space-y-3",appear:"",onBeforeEnter:z,onEnter:n},{default:I(()=>[f.jobs.length>0?(r(!0),l(R,{key:0},U(f.jobs,(s,C)=>q((r(),l("div",{key:s.id,"data-index":C,class:"bg-gradient-to-br from-white to-primary/20 border border-primary shadow-md p-4 rounded-xl cursor-pointer transition-all duration-300 hover:shadow-xl hover:-translate-y-1.5"},[e("div",_e,[e("div",ke,[e("h3",Ce,i(s.job_title),1),e("div",Me,[e("p",Je,i(s.customer.company)+" â€¢ "+i(s.customer.name),1),s.customer.is_owing?(r(),l("span",je," Owing ")):E("",!0)])]),e("span",{class:W([{"bg-gray-100 text-gray-700":!s.status,"bg-green-100 text-green-700":s.status==="completed","bg-blue-100 text-blue-700":s.status==="in_progress","bg-yellow-100 text-yellow-700":s.status==="pending","bg-red-100 text-red-700":s.status==="overdue"},"text-xs font-medium px-3 py-1 rounded-full capitalize shadow-sm transform transition-all hover:scale-105"])},i(s.status||"not started"),3)]),e("div",Be,[e("div",$e,[e("div",Ee,[e("div",Ve,[e("div",Te,[(r(),l("svg",Ae,t[1]||(t[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])))]),e("div",null,[t[2]||(t[2]=e("p",{class:"text-xs text-gray-500"},"Amount",-1)),e("p",Ne,i(g(s.amount)),1)])]),s.due_date?(r(),l("div",Fe,[e("div",Se,[(r(),l("svg",ze,t[3]||(t[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)])))]),e("div",null,[t[4]||(t[4]=e("p",{class:"text-xs text-gray-500"},"Due Date",-1)),e("p",De,i(A(s.due_date)),1)])])):E("",!0)]),e("div",Re,[e("div",Pe,[e("div",Ie,[(r(),l("svg",He,t[5]||(t[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])))]),e("div",null,[t[6]||(t[6]=e("p",{class:"text-xs text-gray-500"},"Paid",-1)),e("p",Le,i(g(L.value[s.id])),1)])]),e("div",Oe,[e("div",Ye,[(r(),l("svg",Ue,t[7]||(t[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])))]),e("div",null,[t[8]||(t[8]=e("p",{class:"text-xs text-gray-500"},"Balance",-1)),e("p",{class:W(["text-sm font-medium",_(s)])},i(g(h(s))),3)])])])]),e("div",qe,[s.satisfaction_score?(r(),l("div",We,[(r(),l("svg",Ge,t[9]||(t[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"},null,-1)]))),e("span",Ke,i(s.satisfaction_score)+"/5",1)])):(r(),l("div",Qe)),e("div",Xe,[e("button",{onClick:P(v=>N(s),["stop"]),class:"group flex items-center justify-center p-2 rounded-lg transition-all duration-200 hover:bg-white hover:shadow-md",style:{border:"1px solid rgba(var(--primary-rgb), 0.3)"},title:"View details"},[(r(),l("svg",et,t[10]||(t[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])))],8,Ze),s.status!=="completed"?(r(),l("button",{key:0,onClick:v=>j(s.id),class:"group flex bg-teal-100 items-center text-primary-dark justify-center p-2 rounded-lg transition-all duration-200 hover:bg-white hover:shadow-md",title:"Mark Complete"},t[11]||(t[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]),8,tt)):E("",!0),e("button",{onClick:P(v=>k(s),["stop"]),class:"group flex items-center justify-center p-2 rounded-lg transition-all duration-200 hover:bg-white hover:shadow-md",style:{border:"1px solid rgba(59, 130, 246, 0.3)"},title:"Edit job"},t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,ot),e("button",{onClick:P(v=>S(s),["stop"]),class:"group flex items-center justify-center p-2 rounded-lg transition-all duration-200 hover:bg-white hover:shadow-md",style:{border:"1px solid rgba(239, 68, 68, 0.3)"},title:"Delete job"},t[13]||(t[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,st)])])])],8,xe)),[[w]])),128)):(r(),l("div",rt,[t[14]||(t[14]=e("p",{class:"text-gray-600 mb-4"}," No jobs yet ",-1)),e("button",{onClick:t[0]||(t[0]=(...s)=>o.createJob&&o.createJob(...s)),class:"bg-primary-dark text-white font-semibold px-6 py-2 rounded-lg hover:bg-primary-light transition"}," Create a Job ")]))]),_:1}))])],64)}}},nt=G(at,[["__scopeId","data-v-5802e8e4"]]),it={class:"space-y-6"},dt={"data-aos":"fade-up","data-aos-duration":"400","data-aos-delay":"100"},ct={__name:"Jobs",props:{jobs:Array},setup(f){const x=d({}),c=d(!1),m=d({}),p=d(!1),b=d(null),j=d(!1),h=d(null),_=d(!1),B=({payload:n})=>{h.value=n,_.value=!0},g=()=>{h.value=null,_.value=!1},A=()=>{H.get("/get_customer").then(n=>{b.value=n.data}).catch(n=>{console.error("API error:",n)})},k=()=>{j.value=!0,re.reload({preserveScroll:!0,onFinish:()=>{j.value=!1}})},N=()=>{A(),p.value=!0},F=()=>{p.value=!1,b.value=null,m.value={},x.value={},c.value=!1},S=({payload:n})=>{c.value=!0,m.value=n,x.value=m.value.customer,p.value=!0};oe(()=>{Q.init({once:!0,easing:"ease-out-cubic",offset:50})});let z=({payload:n,jobId:u})=>{H.patch(`/job_update/status/${u}`,{type:"complete_job",satisfaction_score:n}).then(D=>{k(),g(),alert(D.data.message)})};return(n,u)=>(r(),V(me,null,{default:I(()=>[T(ie,{showModal:p.value,customer:x.value,isEditingJob:c.value,jobToEdit:m.value,allCustomers:b.value,onClose:F,onSubmit:k},null,8,["showModal","customer","isEditingJob","jobToEdit","allCustomers"]),T(pe,{jobId:h.value,showModal:_.value,onSubmit:se(z),onClose:g},null,8,["jobId","showModal","onSubmit"]),e("header",{class:"mb-8"},[e("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},[u[2]||(u[2]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"hidden md:block w-1.5 h-8 rounded-full bg-primary"}),e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"All Jobs"),e("p",{class:"text-gray-500 dark:text-gray-400 mt-1"}," Overview of all your active and completed jobs ")])],-1)),e("div",{class:"flex gap-3"},[e("button",{onClick:N,class:"flex items-center gap-2 px-4 py-2.5 bg-primary hover:bg-primary-dark text-white rounded-lg transition-all shadow-sm hover:shadow-md"},u[0]||(u[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),e("span",null,"New Job",-1)])),e("button",{onClick:k,class:"flex items-center gap-2 px-4 py-2.5 border border-gray-300 hover:border-primary/30 bg-white hover:bg-primary/5 text-gray-700 rounded-lg transition-all shadow-sm hover:shadow-md"},u[1]||(u[1]=[e("span",null,"Refresh",-1)]))])])]),e("div",it,[e("div",dt,[T(nt,{jobs:f.jobs,allCustomers:b.value,onIsEditing:S,onJobCompleted:B,class:"mt-6"},null,8,["jobs","allCustomers"])])])]),_:1}))}},kt=G(ct,[["__scopeId","data-v-89b5f640"]]);export{kt as default};
