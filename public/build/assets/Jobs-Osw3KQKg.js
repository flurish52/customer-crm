import{m as u,j as l,k as x,o as r,b as t,F as j,q as B,n as J,t as a,e as h,g as S,N as Y,c as D,w as z,i as G,d as A,O,a as U,T as q}from"./app-YBu4Y6a0.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as W}from"./index-DKtf60Sy.js";import{d as M}from"./dayjs.min-BtvDDNs6.js";import{V as K}from"./CreateJob-CGhbaDgq.js";const Q={class:"bg-white rounded-xl shadow-lg w-full max-w-md transform transition-all duration-300"},X={class:"p-6"},Z={class:"text-center"},tt={class:"flex flex-col items-center mb-8"},et={class:"flex justify-center space-x-2 mb-2"},st=["onClick"],ot={class:"text-xl"},rt={class:"flex justify-between w-full max-w-xs text-sm text-primary-dark/80"},lt={class:"flex items-center justify-center"},nt=["disabled"],at={__name:"JobRating",props:{showModal:Boolean,jobId:Number},emits:["submit","close"],setup(m,{emit:w}){let v=m;const i=u(null),d=w,f=p=>{i.value=p},b=p=>[{emoji:"ðŸ˜ž",label:"Poor"},{emoji:"ðŸ™",label:"Fair"},{emoji:"ðŸ˜",label:"Good"},{emoji:"ðŸ™‚",label:"Very Good"},{emoji:"ðŸ˜",label:"Excellent"}][p-1],_=async()=>{!i.value||!v.jobId||d("submit",{payload:i.value,jobId:v.jobId})},g=()=>{d("close")};return(p,c)=>m.showModal?(r(),l("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50 p-4 transition-opacity duration-300",onClick:h(g,["self"])},[t("div",Q,[t("div",X,[t("div",Z,[c[0]||(c[0]=t("h3",{class:"text-xl font-bold text-primary-dark mb-2"},"Rate his satisfaction",-1)),c[1]||(c[1]=t("p",{class:"text-secondary-dark mb-6"},"How would you rate your customer's satisfaction?",-1)),t("div",tt,[t("div",et,[(r(),l(j,null,B(5,n=>t("button",{key:n,onClick:$=>f(n),class:J(["w-12 h-12 rounded-full flex items-center justify-center transition-all duration-200",{"bg-primary-light/20 text-primary-DEFAULT border-2 border-primary-DEFAULT":i.value===n,"bg-tertiary-light text-tertiary-dark hover:bg-primary-light/10":i.value!==n}])},[t("span",ot,a(b(n).emoji),1)],10,st)),64))]),t("div",rt,[(r(),l(j,null,B(5,n=>t("span",{key:"label-"+n,class:"w-12 text-center"},a(b(n).label),1)),64))])]),t("div",lt,[t("button",{onClick:g,class:"w-full mx-3 py-3 bg-white text-primary rounded-lg hover:bg-tertiary-dark border-2 border-primary transition-colors"}," Cancel "),t("button",{onClick:_,disabled:!i.value,class:"w-full mx-3 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:bg-primary-light disabled:cursor-not-allowed"}," Submit Rating ",8,nt)])])])])])):x("",!0)}},oe=L(at,[["__scopeId","data-v-9f103ab9"]]),it={class:"space-y-4"},dt=["data-index"],ct={class:"flex justify-between items-start mb-3"},ut={class:"max-w-[80%]"},mt={class:"font-semibold text-lg truncate text-primary-dark"},pt={class:"flex items-center mt-1"},yt={class:"text-sm opacity-80 truncate text-secondary-gray-400"},gt={key:0,class:"ml-2 text-xs px-2 py-0.5 bg-red-100 text-red-700 rounded-full"},vt={class:"mt-4 pt-4",style:{borderTop:"1px solid rgba(var(--primary-rgb), 0.1)"}},bt={class:"grid grid-cols-2 gap-4 mb-4"},xt={class:"space-y-2"},ht={class:"flex items-center"},wt={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},ft={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},_t={class:"text-sm font-medium"},kt={key:0,class:"flex items-center"},Ct={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},Mt={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},jt={class:"text-sm font-medium"},Bt={class:"space-y-2"},Jt={class:"flex items-center"},$t={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},Nt={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},Vt={class:"text-sm font-medium text-green-600"},Et={class:"flex items-center"},Dt={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},zt={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},At={class:"flex items-center justify-between"},Lt={key:0,class:"flex items-center rounded-full px-3 py-1.5 backdrop-blur-sm",style:{background:"rgba(var(--primary-rgb), 0.15)"}},Pt={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},Ft={class:"text-xs font-medium"},It={key:1},Rt={class:"flex justify-end space-x-2 bg-tertiary-dark/20 p-1 rounded-md"},Tt={class:"flex justify-center items-center space-x-2"},Ht=["disabled","onClick"],St={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Yt={key:1,class:"h-5 w-5 animate-spin",viewBox:"0 0 24 24",fill:"none"},Gt=["onClick"],Ot={xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},Ut=["onClick"],qt=["onClick"],Wt={key:1,class:"flex flex-col items-center justify-center p-6 bg-gray-50 rounded-lg shadow-md text-center"},Kt={class:"border rounded-lg p-5",style:{backgroundColor:"var(--secondary)",borderColor:"var(--tertiary)"}},Qt={__name:"Jobs",props:{jobs:{type:Array,required:!0},showModal:Boolean,allCustomers:Array},emits:["closeModal","showModal","isEditing","update","jobCompleted"],setup(m,{emit:w}){const v=m,i=w,d=u(null),f=u({});u(!1),u({});let b=u(!1),_=u(!1);const g=s=>{const e=N.value[s.id];return Number(s.amount||0)-Number(e)},p=s=>g(s)<=0?"text-green-600":M().isAfter(M(s.due_date))&&s.status!=="completed"?"text-yellow-600":"text-red-600",c=s=>s?s.filter(e=>e.type==="payment").reduce((e,y)=>{const o=JSON.parse(y.changes);return e+Number(o.amount)},0):0,n=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"NGN"}).format(s),$=s=>s?M(s).format("MMM D, YYYY"):"Not set",P=s=>{var y;let e=(y=s.activities)==null?void 0:y.filter(o=>o.type==="payment").reduce((o,k)=>o+Number(JSON.parse(k.changes).amount),0);i("showModal"),f.value=s.customer,i("isEditing",{payload:s,amountPaid:e})},F=s=>{d.value=s},I=()=>{d.value=null},R=s=>{confirm(`Are you sure you want to delete "${s.job_title}"?`)&&axios.delete(`/job_delete/${s.id}`).then(e=>{e.status===200&&(i("update"),alert(e.data))}).catch(e=>{console.error("Error deleting job:",e),alert("Failed to delete job. Please try again.")})},T=s=>{s.style.opacity=0,s.style.transform="translateY(20px)"},H=(s,e)=>{W.to(s,{opacity:1,y:0,duration:.5,delay:s.dataset.index*.1,onComplete:e})},N=S(()=>v.jobs.reduce((s,e)=>(s[e.id]=c(e.activities),s),{}));return(s,e)=>{const y=Y("motion-slide-visible-once-bottom");return r(),l("div",it,[d.value?(r(),D(q,{key:1,name:"fade-slide",mode:"out-in"},{default:z(()=>[t("div",Kt,[U(K,{onCloseModal:I,selectedJob:d.value},null,8,["selectedJob"])])]),_:1})):(r(),D(O,{key:0,name:"staggered-fade",tag:"div",class:"space-y-3",appear:"",onBeforeEnter:T,onEnter:H},{default:z(()=>[m.jobs.length>0?(r(!0),l(j,{key:0},B(m.jobs,(o,k)=>{var V,E;return G((r(),l("div",{key:o.id,"data-index":k,class:"bg-gradient-to-br from-white to-primary/20 border border-primary shadow-md px-2 rounded-xl cursor-pointer transition-all duration-300 hover:shadow-xl hover:-translate-y-1.5"},[t("div",ct,[t("div",ut,[t("h3",mt,a(o.job_title),1),t("div",pt,[t("p",yt,a((V=o.customer)==null?void 0:V.company)+" â€¢ "+a((E=o.customer)==null?void 0:E.name),1),o.customer.is_owing?(r(),l("span",gt," Owing ")):x("",!0)])]),t("span",{class:J([{"bg-gray-100 text-gray-700":!o.status,"bg-green-100 text-green-700":o.status==="completed","bg-blue-100 text-blue-700":o.status==="in_progress","bg-yellow-100 text-yellow-700":o.status==="pending","bg-red-100 text-red-700":o.status==="overdue"},"text-xs font-medium px-3 py-1 rounded-full capitalize shadow-sm transform transition-all hover:scale-105"])},a(o.status||"not started"),3)]),t("div",vt,[t("div",bt,[t("div",xt,[t("div",ht,[t("div",wt,[(r(),l("svg",ft,e[1]||(e[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])))]),t("div",null,[e[2]||(e[2]=t("p",{class:"text-xs text-gray-500"},"Amount",-1)),t("p",_t,a(n(o.amount)),1)])]),o.due_date?(r(),l("div",kt,[t("div",Ct,[(r(),l("svg",Mt,e[3]||(e[3]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)])))]),t("div",null,[e[4]||(e[4]=t("p",{class:"text-xs text-gray-500"},"Due Date",-1)),t("p",jt,a($(o.due_date)),1)])])):x("",!0)]),t("div",Bt,[t("div",Jt,[t("div",$t,[(r(),l("svg",Nt,e[5]||(e[5]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])))]),t("div",null,[e[6]||(e[6]=t("p",{class:"text-xs text-gray-500"},"Paid",-1)),t("p",Vt,a(n(N.value[o.id])),1)])]),t("div",Et,[t("div",Dt,[(r(),l("svg",zt,e[7]||(e[7]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])))]),t("div",null,[e[8]||(e[8]=t("p",{class:"text-xs text-gray-500"},"Balance",-1)),t("p",{class:J(["text-sm font-medium",p(o)])},a(n(g(o))),3)])])])]),t("div",At,[o.satisfaction_score?(r(),l("div",Lt,[(r(),l("svg",Pt,e[9]||(e[9]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"},null,-1)]))),t("span",Ft,a(o.satisfaction_score)+"/5",1)])):(r(),l("div",It)),t("div",Rt,[t("div",Tt,[o.status!=="completed"?(r(),l("button",{key:0,type:"button",disabled:A(_)||A(b),onClick:C=>s.$emit("completeJob",{payload:o.id}),class:"flex items-center justify-center gap-2 h-6 w-6 rounded-2xl border border-emerald-600 text-emerald-700 hover:bg-emerald-50 disabled:opacity-60 disabled:cursor-not-allowed shadow-sm","aria-label":"Mark complete",title:"Mark complete"},[s.loading?(r(),l("svg",Yt,e[11]||(e[11]=[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",opacity:"0.25","stroke-width":"4"},null,-1),t("path",{d:"M22 12a10 10 0 0 1-10 10",stroke:"currentColor","stroke-width":"4",opacity:"0.95"},null,-1)]))):(r(),l("svg",St,e[10]||(e[10]=[t("path",{d:"M9 12l2 2 4-4"},null,-1),t("circle",{cx:"12",cy:"12",r:"9"},null,-1)])))],8,Ht)):x("",!0),t("button",{onClick:h(C=>F(o),["stop"]),class:"group flex items-center justify-center p-2 rounded-lg transition-all duration-200 hover:bg-white hover:shadow-md",style:{border:"1px solid rgba(var(--primary-rgb), 0.3)"},title:"View details"},[(r(),l("svg",Ot,e[12]||(e[12]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])))],8,Gt),t("button",{onClick:h(C=>P(o),["stop"]),class:"group flex items-center justify-center p-2 rounded-lg transition-all duration-200 hover:bg-white hover:shadow-md",style:{border:"1px solid rgba(59, 130, 246, 0.3)"},title:"Edit job"},e[13]||(e[13]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,Ut),t("button",{onClick:h(C=>R(o),["stop"]),class:"group flex items-center justify-center p-2 rounded-lg transition-all duration-200 hover:bg-white hover:shadow-md",style:{border:"1px solid rgba(239, 68, 68, 0.3)"},title:"Delete job"},e[14]||(e[14]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,qt)])])])])],8,dt)),[[y]])}),128)):(r(),l("div",Wt,[e[15]||(e[15]=t("p",{class:"text-gray-600 mb-4"}," No jobs yet ",-1)),t("button",{onClick:e[0]||(e[0]=(...o)=>s.createJob&&s.createJob(...o)),class:"bg-primary-dark text-white font-semibold px-6 py-2 rounded-lg hover:bg-primary-light transition"}," Create a Job ")]))]),_:1}))])}}},re=L(Qt,[["__scopeId","data-v-839c92c2"]]);export{oe as J,re as a};
