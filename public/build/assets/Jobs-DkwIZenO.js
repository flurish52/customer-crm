import{A as H}from"./aos-DP9o1HBT.js";import{J as q,a as G}from"./Jobs-By5V5Yhu.js";import{_ as W}from"./AuthenticatedLayout-sUCu0LFZ.js";import{m as a,j as K,p as Q,N as X,c as A,o as d,w as Y,a as x,b as e,d as g,g as C,F as Z,q as ee,k as oe,s as p,i as te,t as k,x as re,f as se,n as J,C as ae,z as B}from"./app-BExok_hY.js";import{r as le,C as ne}from"./CreateJob-Xt2BcM_5.js";import{d as E}from"./dayjs.min-Csiqzeu9.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as de}from"./BriefcaseIcon-DOuYRYjz.js";import{r as ue}from"./CurrencyDollarIcon-y9-T4At4.js";import{r as ce}from"./CheckCircleIcon-6VsAA9sg.js";import"./index-DKtf60Sy.js";const me={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},be={class:"flex items-center justify-between"},ge={class:"text-sm text-gray-500"},pe={class:"text-xl font-bold"},ve={key:0,class:"mt-2 pt-2 border-t border-primary/10"},fe={class:"text-xs text-gray-500 flex items-center"},he={class:"px-6 py-4 border-b border-tertiary-light flex justify-between items-center"},ye={class:"flex items-center space-x-2"},we={class:"space-y-6"},xe={"data-aos":"fade-up","data-aos-duration":"400","data-aos-delay":"100"},Ce={__name:"Jobs",props:{jobs:Array},setup(j){const n=j,v=a({}),f=a(!1),u=a({}),c=a(!1),m=a(null),_=a(!1);let F=a(null),h=a(!1),T=a(0);a(0);const M=()=>{B.get("/get_customer").then(o=>{m.value=o.data}).catch(o=>{console.error("API error:",o)})},N=()=>{_.value=!0,ae.reload({preserveScroll:!0,onFinish:()=>{_.value=!1}})},V=()=>{M(),c.value=!0},S=()=>{c.value=!1,m.value=null,u.value={},v.value={},f.value=!1},P=({payload:o,amountPaid:t})=>{T.value=t,f.value=!0,u.value=o,v.value=u.value.customer,c.value=!0},R=K(()=>{const o=n.jobs.length,t=n.jobs.filter(s=>s.status==="completed").length,l=n.jobs.reduce((s,i)=>s+Number(i.amount||0),0),r=n.jobs.reduce((s,i)=>s+D(i.activities),0),w=l-r,O=n.jobs.filter(s=>s.due_date&&E().isAfter(E(s.due_date))&&s.status!=="completed").length,b=n.jobs.filter(s=>s.satisfaction_score),U=b.length>0?b.reduce((s,i)=>s+Number(i.satisfaction_score),0)/b.length:0;return[{label:"Total Jobs",value:o,subValue:`${t} completed`,icon:de,color:"var(--primary)",bgColor:"rgba(var(--primary-rgb), 0.1)",dotColor:"#10B981"},{label:"Total Amount",value:y(l),subValue:y(w)+" outstanding",icon:ue,color:"#3B82F6",bgColor:"rgba(59, 130, 246, 0.1)",dotColor:"#F59E0B"},{label:"Total Paid",value:y(r),subValue:`${O} overdue jobs`,icon:ce,color:"#10B981",bgColor:"rgba(16, 185, 129, 0.1)",dotColor:"#EF4444"},{label:"Avg. Rating",value:U.toFixed(1),subValue:`${b.length} ratings`,icon:le,color:"#F59E0B",bgColor:"rgba(245, 158, 11, 0.1)",dotColor:"#3B82F6"}]}),I=o=>{const t=[{border:"primary",bgTo:"primary/20"},{border:"blue-500",bgTo:"blue-500/20"},{border:"green-500",bgTo:"green-500/20"},{border:"yellow-500",bgTo:"yellow-500/20"}];return{borderColor:`var(--${t[o].border})`,background:`linear-gradient(to bottom right, white, var(--${t[o].bgTo}))`}},D=o=>o?o.filter(t=>t.type==="payment").reduce((t,l)=>{const r=JSON.parse(l.changes);return t+Number(r.amount)},0):0,y=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"NGN"}).format(o);let z=({payload:o,jobId:t})=>{B.patch(`/job_update/status/${t}`,{type:"complete_job",satisfaction_score:o}).then(l=>{$(),alert(l.data.message)})};const $=()=>{h.value=!1},L=({payload:o})=>{F.value=o,h.value=!0};return Q(()=>{H.init({once:!0,easing:"ease-out-cubic",offset:50})}),(o,t)=>{const l=X("motion-pop");return d(),A(W,null,{default:Y(()=>[x(ne,{showModal:c.value,customer:v.value,isEditingJob:f.value,jobToEdit:u.value,amountPaid:g(T),allCustomers:m.value,onClose:S,onSubmit:N},null,8,["showModal","customer","isEditingJob","jobToEdit","amountPaid","allCustomers"]),x(q,{jobId:g(F),showModal:g(h),onSubmit:g(z),onClose:$},null,8,["jobId","showModal","onSubmit"]),e("header",{class:"mb-8"},[e("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},[t[5]||(t[5]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"hidden md:block w-1.5 h-8 rounded-full bg-primary"}),e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"All Jobs"),e("p",{class:"text-gray-500 dark:text-gray-400 mt-1"}," Overview of all your active and completed jobs ")])],-1)),e("div",{class:"flex gap-3"},[e("button",{onClick:V,class:"flex items-center gap-2 px-4 py-2.5 bg-primary hover:bg-primary-dark text-white rounded-lg transition-all shadow-sm hover:shadow-md"},t[3]||(t[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),e("span",null,"New Job",-1)])),t[4]||(t[4]=e("button",{class:"flex items-center gap-2 px-4 py-2.5 border border-gray-300 hover:border-primary/30 bg-white hover:bg-primary/5 text-gray-700 rounded-lg transition-all shadow-sm hover:shadow-md"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})]),e("span",null,"Filters")],-1))])])]),e("div",me,[(d(!0),C(Z,null,ee(R.value,(r,w)=>oe((d(),C("div",{key:r.label,class:"bg-gradient-to-br from-white to-primary/20 border border-primary/30 p-4 rounded-xl shadow-sm transition-all hover:shadow-md",style:p(I(w))},[e("div",be,[e("div",null,[e("p",ge,k(r.label),1),e("h3",pe,k(r.value),1)]),e("div",{class:"p-3 rounded-lg",style:p({background:r.bgColor})},[(d(),A(re(r.icon),{class:"h-6 w-6",style:p({color:r.color})},null,8,["style"]))],4)]),r.subValue?(d(),C("div",ve,[e("p",fe,[e("span",{class:"w-2 h-2 rounded-full mr-1",style:p({background:r.dotColor})},null,4),se(" "+k(r.subValue),1)])])):te("",!0)],4)),[[l]])),128))]),e("div",he,[t[6]||(t[6]=e("h2",{class:"text-xl font-bold text-primary-dark"},"Job History",-1)),e("div",ye,[e("button",{onClick:t[0]||(t[0]=r=>o.filterJobs("all")),class:J(["px-3 py-1 text-sm rounded-md",{"bg-primary-DEFAULT text-white":o.activeFilter==="all","text-primary-dark hover:bg-tertiary-light":o.activeFilter!=="all"}])}," All ",2),e("button",{onClick:t[1]||(t[1]=r=>o.filterJobs("active")),class:J(["px-3 py-1 text-sm rounded-md",{"bg-secondary-light text-secondary-dark":o.activeFilter==="active","text-primary-dark hover:bg-tertiary-light":o.activeFilter!=="active"}])}," Active ",2),e("button",{onClick:t[2]||(t[2]=r=>o.filterJobs("completed")),class:J(["px-3 py-1 text-sm rounded-md",{"bg-green-100 text-green-800":o.activeFilter==="completed","text-primary-dark hover:bg-tertiary-light":o.activeFilter!=="completed"}])}," Completed ",2)])]),e("div",we,[e("div",xe,[x(G,{jobs:j.jobs,allCustomers:m.value,onIsEditing:P,onCompleteJob:L,class:"mt-6"},null,8,["jobs","allCustomers"])])])]),_:1})}}},Ne=ie(Ce,[["__scopeId","data-v-e3f226d8"]]);export{Ne as default};
