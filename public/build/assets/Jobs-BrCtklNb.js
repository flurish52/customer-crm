import{m,j as l,k as y,o as r,b as t,F as B,q as J,n as $,t as a,e as f,g as Y,N as G,c as D,w as z,i as O,d as A,O as U,a as q,T as W}from"./app-z7IybkHb.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as K}from"./index-DKtf60Sy.js";import{d as j}from"./dayjs.min-hRNrxJVT.js";import{V as Q}from"./CreateJob-Cma4VOwE.js";const X={class:"bg-white rounded-xl shadow-lg w-full max-w-md transform transition-all duration-300"},Z={class:"p-6"},tt={class:"text-center"},et={class:"flex flex-col items-center mb-8"},st={class:"flex justify-center space-x-2 mb-2"},ot=["onClick"],rt={class:"text-xl"},lt={class:"flex justify-between w-full max-w-xs text-sm text-primary-dark/80"},nt={class:"flex items-center justify-center"},at=["disabled"],it={__name:"JobRating",props:{showModal:Boolean,jobId:Number},emits:["submit","close"],setup(p,{emit:k}){let v=p;const n=m(null),d=k,_=c=>{n.value=c},b=c=>[{emoji:"😞",label:"Poor"},{emoji:"🙁",label:"Fair"},{emoji:"😐",label:"Good"},{emoji:"🙂",label:"Very Good"},{emoji:"😍",label:"Excellent"}][c-1],C=async()=>{!n.value||!v.jobId||d("submit",{payload:n.value,jobId:v.jobId})},h=()=>{d("close")};return(c,u)=>p.showModal?(r(),l("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50 p-4 transition-opacity duration-300",onClick:f(h,["self"])},[t("div",X,[t("div",Z,[t("div",tt,[u[0]||(u[0]=t("h3",{class:"text-xl font-bold text-primary-dark mb-2"},"Rate his satisfaction",-1)),u[1]||(u[1]=t("p",{class:"text-secondary-dark mb-6"},"How would you rate your customer's satisfaction?",-1)),t("div",et,[t("div",st,[(r(),l(B,null,J(5,i=>t("button",{key:i,onClick:x=>_(i),class:$(["w-12 h-12 rounded-full flex items-center justify-center transition-all duration-200",{"bg-primary-light/20 text-primary-DEFAULT border-2 border-primary-DEFAULT":n.value===i,"bg-tertiary-light text-tertiary-dark hover:bg-primary-light/10":n.value!==i}])},[t("span",rt,a(b(i).emoji),1)],10,ot)),64))]),t("div",lt,[(r(),l(B,null,J(5,i=>t("span",{key:"label-"+i,class:"w-12 text-center"},a(b(i).label),1)),64))])]),t("div",nt,[t("button",{onClick:h,class:"w-full mx-3 py-3 bg-white text-primary rounded-lg hover:bg-tertiary-dark border-2 border-primary transition-colors"}," Cancel "),t("button",{onClick:C,disabled:!n.value,class:"w-full mx-3 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:bg-primary-light disabled:cursor-not-allowed"}," Submit Rating ",8,at)])])])])])):y("",!0)}},le=L(it,[["__scopeId","data-v-9f103ab9"]]),dt={class:"space-y-4"},ct=["data-index"],ut={class:"flex justify-between items-start mb-3"},mt={class:"max-w-[80%]"},pt={class:"font-semibold text-lg truncate text-primary-dark"},gt={class:"flex items-center mt-1"},yt={class:"text-sm opacity-80 truncate text-secondary-gray-400"},vt={key:0,class:"ml-2 text-xs px-2 py-0.5 bg-red-100 text-red-700 rounded-full"},bt={class:"mt-4 pt-4",style:{borderTop:"1px solid rgba(var(--primary-rgb), 0.1)"}},ht={class:"grid grid-cols-2 gap-4 mb-4"},xt={class:"space-y-2"},wt={class:"flex items-center"},ft={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},kt={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},_t={class:"text-sm font-medium"},Ct={key:0,class:"flex items-center"},Mt={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},jt={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},Bt={class:"text-sm font-medium"},Jt={class:"space-y-2"},$t={class:"flex items-center"},Nt={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},Vt={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},Et={class:"text-sm font-medium text-green-600"},Dt={class:"flex items-center"},zt={class:"p-2 rounded-lg mr-2",style:{background:"rgba(var(--primary-rgb), 0.1)"}},At={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},Lt={class:"flex items-center justify-between"},Pt={key:0,class:"flex items-center rounded-full px-3 py-1.5 backdrop-blur-sm",style:{background:"rgba(var(--primary-rgb), 0.15)"}},Rt={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},Ft={class:"text-xs font-medium"},It={key:1},Tt={class:"flex justify-end space-x-2 bg-tertiary-dark/20 p-1 rounded-md"},Ht={class:"flex justify-center items-center space-x-2"},St=["disabled","onClick"],Yt={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Gt={key:1,class:"h-5 w-5 animate-spin",viewBox:"0 0 24 24",fill:"none"},Ot=["onClick"],Ut={xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--primary)"}},qt=["onClick"],Wt=["onClick"],Kt=["onClick"],Qt={key:1,class:"flex flex-col items-center justify-center p-6 bg-gray-50 rounded-lg shadow-md text-center"},Xt={class:"border rounded-lg p-5",style:{backgroundColor:"var(--secondary)",borderColor:"var(--tertiary)"}},Zt={__name:"Jobs",props:{jobs:{type:Array,required:!0},showModal:Boolean,allCustomers:Array},emits:["closeModal","showModal","isEditing","update","jobCompleted"],setup(p,{emit:k}){const v=p,n=k,d=m(null),_=m({});m(!1),m({});const b=s=>{n("jobCompleted",{payload:s})};let C=m(!1),h=m(!1);const c=s=>{const e=N.value[s.id];return Number(s.amount||0)-Number(e)},u=s=>c(s)<=0?"text-green-600":j().isAfter(j(s.due_date))&&s.status!=="completed"?"text-yellow-600":"text-red-600",i=s=>s?s.filter(e=>e.type==="payment").reduce((e,g)=>{const o=JSON.parse(g.changes);return e+Number(o.amount)},0):0,x=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"NGN"}).format(s),P=s=>s?j(s).format("MMM D, YYYY"):"Not set",R=s=>{var g;let e=(g=s.activities)==null?void 0:g.filter(o=>o.type==="payment").reduce((o,M)=>o+Number(JSON.parse(M.changes).amount),0);n("showModal"),_.value=s.customer,n("isEditing",{payload:s,amountPaid:e})},F=s=>{d.value=s},I=()=>{d.value=null},T=s=>{confirm(`Are you sure you want to delete "${s.job_title}"?`)&&axios.delete(`/job_delete/${s.id}`).then(e=>{e.status===200&&(n("update"),alert(e.data))}).catch(e=>{console.error("Error deleting job:",e),alert("Failed to delete job. Please try again.")})},H=s=>{s.style.opacity=0,s.style.transform="translateY(20px)"},S=(s,e)=>{K.to(s,{opacity:1,y:0,duration:.5,delay:s.dataset.index*.1,onComplete:e})},N=Y(()=>v.jobs.reduce((s,e)=>(s[e.id]=i(e.activities),s),{}));return(s,e)=>{const g=G("motion-slide-visible-once-bottom");return r(),l("div",dt,[d.value?(r(),D(W,{key:1,name:"fade-slide",mode:"out-in"},{default:z(()=>[t("div",Xt,[q(Q,{onCloseModal:I,selectedJob:d.value},null,8,["selectedJob"])])]),_:1})):(r(),D(U,{key:0,name:"staggered-fade",tag:"div",class:"space-y-3",appear:"",onBeforeEnter:H,onEnter:S},{default:z(()=>[p.jobs.length>0?(r(!0),l(B,{key:0},J(p.jobs,(o,M)=>{var V,E;return O((r(),l("div",{key:o.id,"data-index":M,class:"bg-gradient-to-br from-white to-primary/20 border border-primary shadow-md px-2 rounded-xl cursor-pointer transition-all duration-300 hover:shadow-xl hover:-translate-y-1.5"},[t("div",ut,[t("div",mt,[t("h3",pt,a(o.job_title),1),t("div",gt,[t("p",yt,a((V=o.customer)==null?void 0:V.company)+" • "+a((E=o.customer)==null?void 0:E.name),1),o.customer.is_owing?(r(),l("span",vt," Owing ")):y("",!0)])]),t("span",{class:$([{"bg-gray-100 text-gray-700":!o.status,"bg-green-100 text-green-700":o.status==="completed","bg-blue-100 text-blue-700":o.status==="in_progress","bg-yellow-100 text-yellow-700":o.status==="pending","bg-red-100 text-red-700":o.status==="overdue"},"text-xs font-medium px-3 py-1 rounded-full capitalize shadow-sm transform transition-all hover:scale-105"])},a(o.status||"not started"),3)]),t("div",bt,[t("div",ht,[t("div",xt,[t("div",wt,[t("div",ft,[(r(),l("svg",kt,e[1]||(e[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])))]),t("div",null,[e[2]||(e[2]=t("p",{class:"text-xs text-gray-500"},"Amount",-1)),t("p",_t,a(x(o.amount)),1)])]),o.due_date?(r(),l("div",Ct,[t("div",Mt,[(r(),l("svg",jt,e[3]||(e[3]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)])))]),t("div",null,[e[4]||(e[4]=t("p",{class:"text-xs text-gray-500"},"Due Date",-1)),t("p",Bt,a(P(o.due_date)),1)])])):y("",!0)]),t("div",Jt,[t("div",$t,[t("div",Nt,[(r(),l("svg",Vt,e[5]||(e[5]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])))]),t("div",null,[e[6]||(e[6]=t("p",{class:"text-xs text-gray-500"},"Paid",-1)),t("p",Et,a(x(N.value[o.id])),1)])]),t("div",Dt,[t("div",zt,[(r(),l("svg",At,e[7]||(e[7]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])))]),t("div",null,[e[8]||(e[8]=t("p",{class:"text-xs text-gray-500"},"Balance",-1)),t("p",{class:$(["text-sm font-medium",u(o)])},a(x(c(o))),3)])])])]),t("div",Lt,[o.satisfaction_score?(r(),l("div",Pt,[(r(),l("svg",Rt,e[9]||(e[9]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"},null,-1)]))),t("span",Ft,a(o.satisfaction_score)+"/5",1)])):(r(),l("div",It)),t("div",Tt,[t("div",Ht,[o.status!=="completed"?(r(),l("button",{key:0,type:"button",disabled:A(h)||A(C),onClick:w=>s.$emit("completeJob",{payload:o.id}),class:"flex items-center justify-center gap-2 h-6 w-6 rounded-2xl border border-emerald-600 text-emerald-700 hover:bg-emerald-50 disabled:opacity-60 disabled:cursor-not-allowed shadow-sm","aria-label":"Mark complete",title:"Mark complete"},[s.loading?(r(),l("svg",Gt,e[11]||(e[11]=[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",opacity:"0.25","stroke-width":"4"},null,-1),t("path",{d:"M22 12a10 10 0 0 1-10 10",stroke:"currentColor","stroke-width":"4",opacity:"0.95"},null,-1)]))):(r(),l("svg",Yt,e[10]||(e[10]=[t("path",{d:"M9 12l2 2 4-4"},null,-1),t("circle",{cx:"12",cy:"12",r:"9"},null,-1)])))],8,St)):y("",!0),t("button",{onClick:f(w=>F(o),["stop"]),class:"group flex items-center justify-center p-2 rounded-lg transition-all duration-200 hover:bg-white hover:shadow-md",style:{border:"1px solid rgba(var(--primary-rgb), 0.3)"},title:"View details"},[(r(),l("svg",Ut,e[12]||(e[12]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])))],8,Ot),o.status!=="completed"?(r(),l("button",{key:1,onClick:w=>b(o.id),class:"group flex bg-teal-100 items-center text-primary-dark justify-center p-2 rounded-lg transition-all duration-200 hover:bg-white hover:shadow-md",title:"Mark Complete"},e[13]||(e[13]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]),8,qt)):y("",!0),t("button",{onClick:f(w=>R(o),["stop"]),class:"group flex items-center justify-center p-2 rounded-lg transition-all duration-200 hover:bg-white hover:shadow-md",style:{border:"1px solid rgba(59, 130, 246, 0.3)"},title:"Edit job"},e[14]||(e[14]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,Wt),t("button",{onClick:f(w=>T(o),["stop"]),class:"group flex items-center justify-center p-2 rounded-lg transition-all duration-200 hover:bg-white hover:shadow-md",style:{border:"1px solid rgba(239, 68, 68, 0.3)"},title:"Delete job"},e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Kt)])])])])],8,ct)),[[g]])}),128)):(r(),l("div",Qt,[e[16]||(e[16]=t("p",{class:"text-gray-600 mb-4"}," No jobs yet ",-1)),t("button",{onClick:e[0]||(e[0]=(...o)=>s.createJob&&s.createJob(...o)),class:"bg-primary-dark text-white font-semibold px-6 py-2 rounded-lg hover:bg-primary-light transition"}," Create a Job ")]))]),_:1}))])}}},ne=L(Zt,[["__scopeId","data-v-67db24de"]]);export{le as J,ne as a};
